=content_for :head do
  :javascript
    $(function(){
      why.setupProducts();
      why.setupOrders();
      $('#submit').click(function(){ why.createOrder(); return false; })
      $('#watch').click( function(){ $('#movie').slideDown();})
      $('#hide').click(function(){ $('#movie').slideUp(); });
    })

#movie
  %a#hide Hide the video
  %object
    %param{ :name=>"movie", :value=>"http://www.youtube.com/v/v/ytnJlDBwnO8&hl=en_US&fs=1&rel=0&hd=1", :width=>"640", :height=>"385"}
    %embed{ :src=>"http://www.youtube.com/v/ytnJlDBwnO8&hl=en_US&fs=1&rel=0&hd=1", :type=>"application/x-shockwave-flash", :width=>"640", :height=>"385" }
#products
  %h2 Products
  -@product_categories.each do |category, products| 
    %h3
      %span.catselector +
      =category
    %ul
      -products.each do |product|
        %li.product{"data-product_id" => product.id}
          %span
            =product.name
            -if(product.price)
              %span.price{ 'data-price' => product.price }= to_pound(product.price)
#help
  %h2 Help
  %ul
    %li Click on a Product Category to see the items within it
    %li To <strong>add a product to your regular order</strong> drag it from the list on the left into the box titled Regular Order
    %li To <strong>add a product to a specific order</strong> drag it from the list on the left into the box with the correct delivery date
    %li You can <strong>update the quantity</strong> of any product you receive by changing the number to its left
    %li To <strong>remove a product</strong> from either your regular or a specific order set the quantity to 0
    %li Once you are done making your changes click the <strong id="updatetext">update Your Order</strong> button and <em>#{ @supplier.name }</em> will be notified
    %li <strong id="greenbox">Green boxes</strong> are your regular order, <strong id="purplebox">Purple boxes</strong> are orders that differ from your regular order (you might not have any of those yet!)

#deliveries
  #buttons
    %a#submit=submit_text
    %a#undo{ :href => customer_orders_path(@customer.id) } Undo All My Changes
    %a#watch Flummoxed? Watch the video
  %ul.regularOrders
    -@regular_orders.each do |regular|
      %li
        .order
          .note 
            =link_to 'add note', ''
          %h3{"data-regular_order_id" => regular.id} Regular Order
          %ul
            -regular.regular_order_items.each do |oi|
              %li.item{"data-product_id" => oi.product_id} 
                %span.copyable
                  %input.quantity{ :value => oi.quantity }
                  %span.product
                    =oi.product.name
                    %span.price{ 'data-price' => oi.product.price }= to_pound(oi.product.price)
                = select_tag "frequency", options_for_select([ ["every delivery",1],
                  ["every 2 deliveries",2],
                  ["every 3 deliveries",3],
                  ["every 4 deliveries",4],
                  ["every 5 deliveries",5],
                  ["every 6 deliveries",6],
                  ["every 7 deliveries",7],
                  ["every 8 deliveries",8]],oi.frequency), :class => 'frequency' 
                from
                = select_tag "start", options_for_select(@deliveries, oi.first_delivery_date), :class => "start"
            %li.total
          .editNote
            %h3 
              Notes for Reqular Order
              \:
            %textarea{ :rows => 14, :cols => 40 }
              =regular.note
            %br
            =link_to 'close',''
  %hr
  %ul.orders
    -@orders.each do |order|
      %li
        %div{:class => order.new_record? ? "order regular" : "order"}  
          .note 
            =link_to 'add note', ''
          %h3{"data-delivery_id" => order.delivery.id}
            =order.delivery.date.to_s(:short)
          %ul
            -order.order_items.each do |oi|
              %li.item{"data-product_id" => oi.product_id} 
                %input.quantity{ :value => oi.quantity }
                %span.product
                  =oi.product.name
                  %span.price{ 'data-price' => oi.product.price }= to_pound(oi.product.price)
            %li.total
          .editNote
            %h3 
              Notes for
              =order.delivery.date.to_s(:short)
              \:
            %textarea{ :rows => 14, :cols => 40 }
              =order.note
            %br
            =link_to 'close',''

